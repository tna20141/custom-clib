<!DOCTYPE html>
<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>C Preprocessor tricks, tips, and idioms · pfultz2/Cloak Wiki</title>
    <link rel="search" type="application/opensearchdescription+xml" href="https://github.com/opensearch.xml" title="GitHub">
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
    <link rel="apple-touch-icon" sizes="57x57" href="https://github.com/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="114x114" href="https://github.com/apple-touch-icon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="https://github.com/apple-touch-icon-144.png">
    <link rel="apple-touch-icon" sizes="144x144" href="https://github.com/apple-touch-icon-144.png">
    <link rel="logo" type="image/svg" href="https://github-media-downloads.s3.amazonaws.com/github-logo.svg">
    <meta property="og:image" content="https://github.global.ssl.fastly.net/images/modules/logos_page/Octocat.png">
    <meta name="hostname" content="github-fe136-cp1-prd.iad.github.net">
    <meta name="ruby" content="ruby 1.9.3p194-tcs-github-tcmalloc (e1c0c3f392) [x86_64-linux]">
    <link rel="assets" href="https://github.global.ssl.fastly.net/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035/">
    <link rel="xhr-socket" href="https://github.com/_sockets">
    


    <meta name="msapplication-TileImage" content="/windows-tile.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="selected-link" value="repo_wiki" data-pjax-transient="">
    <meta content="collector.githubapp.com" name="octolytics-host"><meta content="collector-cdn.github.com" name="octolytics-script-host"><meta content="github" name="octolytics-app-id"><meta content="013736AC:6705:289191C:52C382A6" name="octolytics-dimension-request_id"><meta content="6202206" name="octolytics-actor-id"><meta content="tna20141" name="octolytics-actor-login"><meta content="81419189d22d8e186b9b12833813a82711700d4a5ad6a8c1b0e612749769153c" name="octolytics-actor-hash">
    

    
    
    <link rel="icon" type="image/x-icon" href="https://github.com/favicon.ico">

    <meta content="authenticity_token" name="csrf-param">
<meta content="AQZISKsZyD9eHbAn+7x9xDU19zGfprD2WealUE75hpc=" name="csrf-token">

    <link href="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/github-3944f96c1c19f752fe766b332fb7716555c8296e.css" media="all" rel="stylesheet" type="text/css">
    <link href="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/github2-7f66047cec22b76987be5f65bf370a5cb7a645d6.css" media="all" rel="stylesheet" type="text/css">
    

    

      <script src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/frameworks-29a3fb0547e33bd8d4530bbad9bae3ef00d83293.js" type="text/javascript"></script>
      <script src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/github-de3e1342dc6592c2ac28e41f41b203f01068205d.js" type="text/javascript"></script><script src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/ga.js" async="" type="text/javascript"></script>
      
      <meta http-equiv="x-pjax-version" content="3cb2fbd97d7aa54718ba9add14536e68">

        <script src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/wiki-d0c3d0f1be4bd69eb1c09955a5d45d29f62a3c5e.js" type="text/javascript"></script>
  <meta property="og:title" content="Cloak">
  <meta property="og:type" content="githubog:gitrepository">
  <meta property="og:url" content="https://github.com/pfultz2/Cloak">
  <meta property="og:image" content="https://github.global.ssl.fastly.net/images/gravatars/gravatar-user-420.png">
  <meta property="og:site_name" content="GitHub">
  <meta property="og:description" content="Cloak - A mini-preprocessor library to demostrate the recursive capabilites of the preprocessor">

  <meta name="description" content="Cloak - A mini-preprocessor library to demostrate the recursive capabilites of the preprocessor">

  <meta content="1306044" name="octolytics-dimension-user_id"><meta content="pfultz2" name="octolytics-dimension-user_login"><meta content="4278201" name="octolytics-dimension-repository_id"><meta content="pfultz2/Cloak" name="octolytics-dimension-repository_nwo"><meta content="true" name="octolytics-dimension-repository_public"><meta content="false" name="octolytics-dimension-repository_is_fork"><meta content="4278201" name="octolytics-dimension-repository_network_root_id"><meta content="pfultz2/Cloak" name="octolytics-dimension-repository_network_root_nwo">
  <link href="https://github.com/pfultz2/Cloak/commits/master.atom" rel="alternate" title="Recent Commits to Cloak:master" type="application/atom+xml">

  <script src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/api.js" async="" type="text/javascript"></script></head>


  <body class="logged_in  env-production linux vis-public">
    <div class="wrapper">
      
      
      
      


      <div class="header header-logged-in true">
  <div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/">
  <span class="mega-octicon octicon-mark-github"></span>
</a>

    
    <a original-title="You have no unread notifications" href="https://github.com/notifications" class="notification-indicator tooltipped downwards" data-gotokey="n">
        <span class="mail-status all-read"></span>
</a>

      <div class="command-bar js-command-bar  in-repository">
          <form accept-charset="UTF-8" action="/search" class="command-bar-form" id="top_search_form" method="get">

<input data-hotkey=" s" name="q" id="js-command-bar-field" placeholder="Search or type a command" tabindex="1" autocapitalize="off" data-username="tna20141" data-repo="pfultz2/Cloak" data-branch="master" data-sha="d8fbd070a217ebd38a0f4bfcfdfd4d3ba387ea34" type="text">

    <input name="nwo" value="pfultz2/Cloak" type="hidden">

    <div class="select-menu js-menu-container js-select-menu search-context-select-menu">
      <span class="minibutton select-menu-button js-menu-target">
        <span class="js-select-button">This repository</span>
      </span>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container">
        <div class="select-menu-modal">

          <div class="select-menu-item js-navigation-item js-this-repository-navigation-item selected">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input class="js-search-this-repository" name="search_target" value="repository" checked="checked" type="radio">
            <div class="select-menu-item-text js-select-button-text">This repository</div>
          </div> <!-- /.select-menu-item -->

          <div class="select-menu-item js-navigation-item js-all-repositories-navigation-item">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input name="search_target" value="global" type="radio">
            <div class="select-menu-item-text js-select-button-text">All repositories</div>
          </div> <!-- /.select-menu-item -->

        </div>
      </div>
    </div>

  <span original-title="Show command bar help" class="octicon help tooltipped downwards">
    <span class="octicon octicon-question"></span>
  </span>


  <input name="ref" value="cmdform" type="hidden">

</form>
        <ul class="top-nav">
          <li class="explore"><a href="https://github.com/explore">Explore</a></li>
            <li><a href="https://gist.github.com/">Gist</a></li>
            <li><a href="https://github.com/blog">Blog</a></li>
          <li><a href="https://help.github.com/">Help</a></li>
        </ul>
      </div>

    


  <ul id="user-links">
    <li>
      <a href="https://github.com/tna20141" class="name">
        <img src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/8d9bcab06e3830d4738ac28a63ed8e19.png" width="20" height="20"> tna20141
      </a>
    </li>

      <li>
        <a original-title="Create a new repo" href="https://github.com/new" id="new_repo" class="tooltipped downwards" aria-label="Create a new repo">
          <span class="octicon octicon-repo-create"></span>
        </a>
      </li>

      <li>
        <a original-title="Account settings " href="https://github.com/settings/profile" id="account_settings" class="tooltipped downwards" aria-label="Account settings ">
          <span class="octicon octicon-tools"></span>
        </a>
      </li>
      <li>
        <a original-title="Sign out" class="tooltipped downwards" href="https://github.com/logout" data-method="post" id="logout" aria-label="Sign out">
          <span class="octicon octicon-log-out"></span>
        </a>
      </li>

  </ul>

<div class="js-new-dropdown-contents hidden">
  

<ul class="dropdown-menu">
  <li>
    <a href="https://github.com/new"><span class="octicon octicon-repo-create"></span> New repository</a>
  </li>
  <li>
    <a href="https://github.com/organizations/new"><span class="octicon octicon-organization"></span> New organization</a>
  </li>



    <li class="section-title">
      <span title="pfultz2/Cloak">This repository</span>
    </li>
      <li>
        <a href="https://github.com/pfultz2/Cloak/issues/new"><span class="octicon octicon-issue-opened"></span> New issue</a>
      </li>
</ul>

</div>


    
  </div>
</div>

      

      




          <div class="site" itemscope="" itemtype="http://schema.org/WebPage">
    
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        

<ul class="pagehead-actions">

    <li class="subscription">
      <form accept-charset="UTF-8" action="/notifications/subscribe" class="js-social-container" data-autosubmit="true" data-remote="true" method="post"><div style="margin:0;padding:0;display:inline"><input name="authenticity_token" value="AQZISKsZyD9eHbAn+7x9xDU19zGfprD2WealUE75hpc=" type="hidden"></div>  <input id="repository_id" name="repository_id" value="4278201" type="hidden">

    <div class="select-menu js-menu-container js-select-menu">
      <a class="social-count js-social-count" href="https://github.com/pfultz2/Cloak/watchers">
        4
      </a>
      <span class="minibutton select-menu-button with-count js-menu-target" role="button" tabindex="0">
        <span class="js-select-button">
          <span class="octicon octicon-eye-watch"></span>
          Watch
        </span>
      </span>

      <div class="select-menu-modal-holder">
        <div class="select-menu-modal subscription-menu-modal js-menu-content">
          <div class="select-menu-header">
            <span class="select-menu-title">Notification status</span>
            <span class="octicon octicon-remove-close js-menu-close"></span>
          </div> <!-- /.select-menu-header -->

          <div class="select-menu-list js-navigation-container" role="menu">

            <div class="select-menu-item js-navigation-item selected" role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input checked="checked" id="do_included" name="do" value="included" type="radio">
                <h4>Not watching</h4>
                <span class="description">You only receive notifications for conversations in which you participate or are @mentioned.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye-watch"></span>
                  Watch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_subscribed" name="do" value="subscribed" type="radio">
                <h4>Watching</h4>
                <span class="description">You receive notifications for all conversations in this repository.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-eye-unwatch"></span>
                  Unwatch
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

            <div class="select-menu-item js-navigation-item " role="menuitem" tabindex="0">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <div class="select-menu-item-text">
                <input id="do_ignore" name="do" value="ignore" type="radio">
                <h4>Ignoring</h4>
                <span class="description">You do not receive any notifications for conversations in this repository.</span>
                <span class="js-select-button-text hidden-select-button-text">
                  <span class="octicon octicon-mute"></span>
                  Stop ignoring
                </span>
              </div>
            </div> <!-- /.select-menu-item -->

          </div> <!-- /.select-menu-list -->

        </div> <!-- /.select-menu-modal -->
      </div> <!-- /.select-menu-modal-holder -->
    </div> <!-- /.select-menu -->

</form>
    </li>

  <li>
  

  <div class="js-toggler-container js-social-container starring-container ">
    <a href="https://github.com/pfultz2/Cloak/unstar" class="minibutton with-count js-toggler-target star-button starred upwards" title="Unstar this repository" data-remote="true" data-method="post" rel="nofollow">
      <span class="octicon octicon-star-delete"></span><span class="text">Unstar</span>
    </a>

    <a href="https://github.com/pfultz2/Cloak/star" class="minibutton with-count js-toggler-target star-button unstarred upwards" title="Star this repository" data-remote="true" data-method="post" rel="nofollow">
      <span class="octicon octicon-star"></span><span class="text">Star</span>
    </a>

      <a class="social-count js-social-count" href="https://github.com/pfultz2/Cloak/stargazers">
        29
      </a>
  </div>

  </li>


        <li>
          <a href="https://github.com/pfultz2/Cloak/fork" class="minibutton with-count js-toggler-target fork-button lighter upwards" title="Fork this repo" rel="nofollow" data-method="post">
            <span class="octicon octicon-git-branch-create"></span><span class="text">Fork</span>
          </a>
          <a href="https://github.com/pfultz2/Cloak/network" class="social-count">4</a>
        </li>


</ul>

        <h1 itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="repo-label"><span>public</span></span>
          <span class="mega-octicon octicon-repo"></span>
          <span class="author">
            <a href="https://github.com/pfultz2" class="url fn" itemprop="url" rel="author"><span itemprop="title">pfultz2</span></a>
          </span>
          <span class="repohead-name-divider">/</span>
          <strong><a href="https://github.com/pfultz2/Cloak" class="js-current-repository js-repo-home-link">Cloak</a></strong>

          <span class="page-context-loader">
            <img alt="Octocat-spinner-32" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
          </span>

        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      

      <div class="repository-with-sidebar repo-container">

        <div class="repository-sidebar">
            

<div class="sunken-menu vertical-right repo-nav js-repo-nav js-repository-container-pjax js-octicon-loaders">
  <div class="sunken-menu-contents">
    <ul class="sunken-menu-group">
      <li original-title="Code" class="tooltipped leftwards">
        <a href="https://github.com/pfultz2/Cloak" aria-label="Code" class="js-selected-navigation-item sunken-menu-item" data-gotokey="c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_tags repo_branches /pfultz2/Cloak">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>      </li>

        <li original-title="Issues" class="tooltipped leftwards">
          <a href="https://github.com/pfultz2/Cloak/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-gotokey="i" data-selected-links="repo_issues /pfultz2/Cloak/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class="counter">0</span>
            <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>        </li>

      <li original-title="Pull Requests" class="tooltipped leftwards">
        <a href="https://github.com/pfultz2/Cloak/pulls" aria-label="Pull Requests" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-gotokey="p" data-selected-links="repo_pulls /pfultz2/Cloak/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class="counter">0</span>
            <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>      </li>


        <li original-title="Wiki" class="tooltipped leftwards">
          <a href="https://github.com/pfultz2/Cloak/wiki" aria-label="Wiki" class="selected js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_wiki /pfultz2/Cloak/wiki">
            <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
            <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>        </li>
    </ul>
    <div class="sunken-menu-separator"></div>
    <ul class="sunken-menu-group">

      <li original-title="Pulse" class="tooltipped leftwards">
        <a href="https://github.com/pfultz2/Cloak/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="pulse /pfultz2/Cloak/pulse">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>      </li>

      <li original-title="Graphs" class="tooltipped leftwards">
        <a href="https://github.com/pfultz2/Cloak/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_graphs repo_contributors /pfultz2/Cloak/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>      </li>

      <li original-title="Network" class="tooltipped leftwards">
        <a href="https://github.com/pfultz2/Cloak/network" aria-label="Network" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-selected-links="repo_network /pfultz2/Cloak/network">
          <span class="octicon octicon-git-branch"></span> <span class="full-word">Network</span>
          <img alt="Octocat-spinner-32" class="mini-loader" src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/octocat-spinner-32.gif" width="16" height="16">
</a>      </li>
    </ul>


  </div>
</div>

            <div class="only-with-full-nav">
              

  

<div class="clone-url open" data-protocol-type="http" data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><strong>HTTPS</strong> clone URL</h3>
  <div class="clone-url-box">
    <input class="clone js-url-field" value="https://github.com/pfultz2/Cloak.git" readonly="readonly" type="text">

    <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/pfultz2/Cloak.git" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>

  

<div class="clone-url " data-protocol-type="ssh" data-url="/users/set_protocol?protocol_selector=ssh&amp;protocol_type=clone">
  <h3><strong>SSH</strong> clone URL</h3>
  <div class="clone-url-box">
    <input class="clone js-url-field" value="git@github.com:pfultz2/Cloak.git" readonly="readonly" type="text">

    <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="git@github.com:pfultz2/Cloak.git" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>

  

<div class="clone-url " data-protocol-type="subversion" data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><strong>Subversion</strong> checkout URL</h3>
  <div class="clone-url-box">
    <input class="clone js-url-field" value="https://github.com/pfultz2/Cloak" readonly="readonly" type="text">

    <span class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/pfultz2/Cloak" data-copied-hint="copied!" title="copy to clipboard"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>,
      <a href="#" class="js-clone-selector" data-protocol="ssh">SSH</a>,
      or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <span original-title="Get help on which URL is right for you." class="octicon help tooltipped upwards">
    <a href="https://help.github.com/articles/which-remote-url-should-i-use">
    <span class="octicon octicon-question"></span>
    </a>
  </span>
</p>



              <a href="https://github.com/pfultz2/Cloak/archive/master.zip" class="minibutton sidebar-button" title="Download this repository as a zip file" rel="nofollow">
                <span class="octicon octicon-cloud-download"></span>
                Download ZIP
              </a>
            </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container="">
          

<div class="tabnav">
  <ul class="tabnav-tabs">
    <li><a href="https://github.com/pfultz2/Cloak/wiki" class="js-selected-navigation-item tabnav-tab" data-selected-links=" /pfultz2/Cloak/wiki">Home</a></li>
    <li><a href="https://github.com/pfultz2/Cloak/wiki/_pages" class="js-selected-navigation-item tabnav-tab" data-selected-links=" /pfultz2/Cloak/wiki/_pages">Pages</a></li>
    <li><a href="https://github.com/pfultz2/Cloak/wiki/_history" class="js-selected-navigation-item tabnav-tab" data-selected-links=" /pfultz2/Cloak/wiki/_history">History</a></li>
  </ul>
</div>



<div id="wiki-wrapper" class="page">
<div id="head">
  <ul class="wiki-actions readability-extra">
    <li class="gollum-minibutton"><a href="https://github.com/pfultz2/Cloak/wiki/C-Preprocessor-tricks,-tips,-and-idioms/_history" class="minibutton bigger action-page-history">
       Page History
     </a></li>
    <li class="gollum-minibutton"><span class="js-zeroclipboard minibutton" data-clipboard-text="https://github.com/pfultz2/Cloak.wiki.git" data-copied-hint="copied!" title="Click to copy url to clipboard">Clone URL</span></li>
  </ul>
  <h1 class="instapaper_title">C Preprocessor tricks, tips, and idioms</h1>
</div>
<div id="wiki-content">
  <div class="wrap">
  <div id="wiki-body" class="gollum-markdown-content instapaper_body">
    <div class="markdown-body">
      <h1>
<a name="basic" class="anchor" href="#basic"><span class="octicon octicon-link"></span></a>Basic</h1>

<h2>
<a name="pattern-matching" class="anchor" href="#pattern-matching"><span class="octicon octicon-link"></span></a>Pattern Matching</h2>

<p>The <code>##</code> operator is used to concatenate two tokens into 
one token. This is provides a very powerful way to do pattern matching. 
Say we want to write a <code>IIF</code> macro, we could write it like this:
</p><div class="highlight"><pre><span class="cp">#define IIF(cond) IIF_ ## cond</span>
<span class="cp">#define IIF_0(t, f) f</span>
<span class="cp">#define IIF_1(t, f) t</span>
</pre></div>
However there is one problem with this approach. A subtle side effect of the <code>##</code> operator is that it inhibits expansion. Heres an example:
<div class="highlight"><pre><span class="cp">#define A() 1</span>
<span class="c1">//This correctly expands to true</span>
<span class="n">IIF</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span> 
<span class="c1">// This will however expand to IIF_A()(true, false)</span>
<span class="c1">// This is because A() doesn't expand to 1,</span>
<span class="c1">// because its inhibited by the ## operator</span>
<span class="n">IIF</span><span class="p">(</span><span class="n">A</span><span class="p">())(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span> 
</pre></div>
The way to work around this is to use another indirection. Sense this is commonly done we can write a macro called <code>CAT</code> that will concatenate without inhibition.
<div class="highlight"><pre><span class="cp">#define CAT(a, ...) PRIMITIVE_CAT(a, __VA_ARGS__)</span>
<span class="cp">#define PRIMITIVE_CAT(a, ...) a ## __VA_ARGS__</span>
</pre></div>
So now we can write the <code>IIF</code> macro(its called <code>IIF</code> right now, later we will show how to define a more generalized way of defining an <code>IF</code> macro):
<div class="highlight"><pre><span class="cp">#define IIF(c) PRIMITIVE_CAT(IIF_, c)</span>
<span class="cp">#define IIF_0(t, ...) __VA_ARGS__</span>
<span class="cp">#define IIF_1(t, ...) t</span>

<span class="cp">#define A() 1</span>
<span class="c1">//This correctly expands to true</span>
<span class="n">IIF</span><span class="p">(</span><span class="mi">1</span><span class="p">)(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span> 
<span class="c1">// And this will also now correctly expand to true</span>
<span class="n">IIF</span><span class="p">(</span><span class="n">A</span><span class="p">())(</span><span class="nb">true</span><span class="p">,</span> <span class="nb">false</span><span class="p">)</span> 
</pre></div>
With pattern matching we can define other operations, such as <code>COMPL</code> which takes the complement:
<div class="highlight"><pre><span class="cp">#define COMPL(b) PRIMITIVE_CAT(COMPL_, b)</span>
<span class="cp">#define COMPL_0 1</span>
<span class="cp">#define COMPL_1 0</span>
</pre></div>
or <code>BITAND</code>:
<div class="highlight"><pre><span class="cp"># define BITAND(x) PRIMITIVE_CAT(BITAND_, x)</span>
<span class="cp"># define BITAND_0(y) 0</span>
<span class="cp"># define BITAND_1(y) y</span>
</pre></div>
We can define increment and decrement operators as macros:
<div class="highlight"><pre><span class="cp">#define INC(x) PRIMITIVE_CAT(INC_, x)</span>
<span class="cp">#define INC_0 1</span>
<span class="cp">#define INC_1 2</span>
<span class="cp">#define INC_2 3</span>
<span class="cp">#define INC_3 4</span>
<span class="cp">#define INC_4 5</span>
<span class="cp">#define INC_5 6</span>
<span class="cp">#define INC_6 7</span>
<span class="cp">#define INC_7 8</span>
<span class="cp">#define INC_8 9</span>
<span class="cp">#define INC_9 9</span>

<span class="cp">#define DEC(x) PRIMITIVE_CAT(DEC_, x)</span>
<span class="cp">#define DEC_0 0</span>
<span class="cp">#define DEC_1 0</span>
<span class="cp">#define DEC_2 1</span>
<span class="cp">#define DEC_3 2</span>
<span class="cp">#define DEC_4 3</span>
<span class="cp">#define DEC_5 4</span>
<span class="cp">#define DEC_6 5</span>
<span class="cp">#define DEC_7 6</span>
<span class="cp">#define DEC_8 7</span>
<span class="cp">#define DEC_9 8</span>
</pre></div>

<h2>
<a name="detection" class="anchor" href="#detection"><span class="octicon octicon-link"></span></a>Detection</h2>

<p>Detection techniques can be used to detect if the parameter is a 
certain value or if it is parenthesis. It relies on vardiac arguments 
expanding to different number of parameters. At the core of detection is
 a <code>CHECK</code> macro with a <code>PROBE</code> macro like this:
</p><div class="highlight"><pre><span class="cp">#define CHECK_N(x, n, ...) n</span>
<span class="cp">#define CHECK(...) CHECK_N(__VA_ARGS__, 0,)</span>
<span class="cp">#define PROBE(x) x, 1,</span>
</pre></div>
This is very simple. When the probe is given to the <code>CHECK</code> macro like this:
<div class="highlight"><pre><span class="n">CHECK</span><span class="p">(</span><span class="n">PROBE</span><span class="p">(</span><span class="o">~</span><span class="p">))</span> <span class="c1">// Expands to 1</span>
</pre></div>
But if we give it a single token:
<div class="highlight"><pre><span class="n">CHECK</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span> <span class="c1">// Expands to 0</span>
</pre></div>
So with this, we can create some detection macros. For instance, if we want to detect for parenthesis:
<div class="highlight"><pre><span class="cp">#define IS_PAREN(x) CHECK(IS_PAREN_PROBE x)</span>
<span class="cp">#define IS_PAREN_PROBE(...) PROBE(~)</span>
<span class="n">IS_PAREN</span><span class="p">(())</span> <span class="c1">// Expands to 1</span>
<span class="n">IS_PAREN</span><span class="p">(</span><span class="n">xxx</span><span class="p">)</span> <span class="c1">// Expands to 0</span>
</pre></div>
Now, say we want to write a generalized <code>IF</code> macro that picks
 false if its 0 otherwise it would pick true. We can use these detection
 techniques to do that. First, we start by writing a <code>NOT</code> operator which is just like an <code>IS_0</code> macro:
<div class="highlight"><pre><span class="cp">#define NOT(x) CHECK(PRIMITIVE_CAT(NOT_, x))</span>
<span class="cp">#define NOT_0 PROBE(~)</span>
</pre></div>
Next we use the <code>COMPL</code> macro that we wrote to inverse this result, and then call <code>IIF</code>:
<div class="highlight"><pre><span class="cp">#define BOOL(x) COMPL(NOT(x))</span>
<span class="cp">#define IF(c) IIF(BOOL(c))</span>
</pre></div>
We can also create a <code>WHEN</code> macro, that only expands whats next, if the condition is true, otherwise it will expand to nothing:
<div class="highlight"><pre><span class="cp">#define EAT(...)</span>
<span class="cp">#define EXPAND(...) __VA_ARGS__</span>
<span class="cp">#define WHEN(c) IF(c)(EXPAND, EAT)</span>
</pre></div>

<h1>
<a name="recursion" class="anchor" href="#recursion"><span class="octicon octicon-link"></span></a>Recursion</h1>

<p>Unfortunately, macros can't expand recursively. When a macro expands,
 it can become painted blue, which prevents it from expanding anymore. 
First, there are ways to work around this to prevent macros from being 
painted blue. Secondly, we can detect if a macro is painted blue(because
 it wont expand) and use this state to expand to a different macro.</p>

<h2>
<a name="deferred-expression" class="anchor" href="#deferred-expression"><span class="octicon octicon-link"></span></a>Deferred expression</h2>

<p>A deferred expression is an expression that requires more scans to fully expand. Heres an example:
</p><div class="highlight"><pre><span class="cp">#define EMPTY()</span>
<span class="cp">#define DEFER(id) id EMPTY()</span>
<span class="cp">#define OBSTRUCT(...) __VA_ARGS__ DEFER(EMPTY)()</span>
<span class="cp">#define EXPAND(...) __VA_ARGS__</span>

<span class="cp">#define A() 123</span>
<span class="n">A</span><span class="p">()</span> <span class="c1">// Expands to 123</span>
<span class="n">DEFER</span><span class="p">(</span><span class="n">A</span><span class="p">)()</span> <span class="c1">// Expands to A () because it requires one more scan to fully expand</span>
<span class="n">EXPAND</span><span class="p">(</span><span class="n">DEFER</span><span class="p">(</span><span class="n">A</span><span class="p">)())</span> <span class="c1">// Expands to 123, because the EXPAND macro forces another scan</span>
</pre></div>
Why is this important? Well when a macro is scanned and expanding, it 
creates a disabling context. This disabling context will cause a token, 
that refers to the currently expanding macro, to be painted blue. Thus, 
once its painted blue, the macro will no longer expand. This is why 
macros don't expand recursively. However, a disabling context only 
exists during one scan, so by deferring an expansion we can prevent our 
macros from becoming painted blue. We will just need to apply more scans
 to the expression. We can do that using this <code>EVAL</code> macro:
<div class="highlight"><pre><span class="cp">#define EVAL(...)  EVAL1(EVAL1(EVAL1(__VA_ARGS__)))</span>
<span class="cp">#define EVAL1(...) EVAL2(EVAL2(EVAL2(__VA_ARGS__)))</span>
<span class="cp">#define EVAL2(...) EVAL3(EVAL3(EVAL3(__VA_ARGS__)))</span>
<span class="cp">#define EVAL3(...) EVAL4(EVAL4(EVAL4(__VA_ARGS__)))</span>
<span class="cp">#define EVAL4(...) EVAL5(EVAL5(EVAL5(__VA_ARGS__)))</span>
<span class="cp">#define EVAL5(...) __VA_ARGS__</span>
</pre></div>
We use a <code>REPEAT_INDIRECT</code> macro to refer back to itself 
recursively. This prevents the macro from being painted blue, since it 
will expand on a different scan(and using a different disabling 
context). We use <code>OBSTRUCT</code> here, which will defer the expansion twice. This is necessary because the conditional <code>WHEN</code> applies one scan already.
<div class="highlight"><pre><span class="cp">#define REPEAT(count, macro, ...) \</span>
<span class="cp">    WHEN(count) \</span>
<span class="cp">    ( \</span>
<span class="cp">        OBSTRUCT(REPEAT_INDIRECT) () \</span>
<span class="cp">        ( \</span>
<span class="cp">            DEC(count), macro, __VA_ARGS__ \</span>
<span class="cp">        ) \</span>
<span class="cp">        OBSTRUCT(macro) \</span>
<span class="cp">        ( \</span>
<span class="cp">            DEC(count), __VA_ARGS__ \</span>
<span class="cp">        ) \</span>
<span class="cp">    )</span>
<span class="cp">#define REPEAT_INDIRECT() REPEAT</span>

<span class="c1">//An example of using this macro</span>
<span class="cp">#define M(i, _) i</span>
<span class="n">EVAL</span><span class="p">(</span><span class="n">REPEAT</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="o">~</span><span class="p">))</span> <span class="c1">// 0 1 2 3 4 5 6 7</span>
</pre></div>
Also we can build a <code>WHILE</code> macro that takes a user defined predicate, like so:
<div class="highlight"><pre><span class="cp">#define WHILE(pred, op, ...) \</span>
<span class="cp">    IF(pred(__VA_ARGS__)) \</span>
<span class="cp">    ( \</span>
<span class="cp">        DEFER(WHILE_INDIRECT) () \</span>
<span class="cp">        ( \</span>
<span class="cp">            pred, op, op(__VA_ARGS__) \</span>
<span class="cp">        ), \</span>
<span class="cp">        __VA_ARGS__ \</span>
<span class="cp">    )</span>
<span class="cp">#define WHILE_INDIRECT() WHILE</span>
</pre></div>
This will keep on applying the <code>op</code> macro until the <code>pred</code> returns true.

<h2>
<a name="comparison" class="anchor" href="#comparison"><span class="octicon octicon-link"></span></a>Comparison</h2>

<p>In order to compare two tokens, we can take advantage of the fact 
that tokens get painted blue. We can put the macro inside of the another
 macro, and then detect if it expands or not. If the two macros are not 
the same then it won't fully expand. So if we want to compare two tokens
 <code>foo</code> and <code>bar</code>, we can define two corresponding marcos:
</p><div class="highlight"><pre><span class="cp">#define COMPARE_foo(x) x</span>
<span class="cp">#define COMPARE_bar(x) x</span>
</pre></div>
And we can put them together to create a primitive compare macro:
<div class="highlight"><pre><span class="cp">#define PRIMITIVE_COMPARE(x, y) IS_PAREN \</span>
<span class="cp">( \</span>
<span class="cp">COMPARE_ ## x ( COMPARE_ ## y) (())  \</span>
<span class="cp">)</span>
</pre></div>
Parenthesis is passed to the compare macros, and then it uses the <code>IS_PAREN</code>
 to detect if the macro fully expands(which it won't expand to 
parenthesis if it was painted blue). So this can be used to see if two 
tokens are not equal, like this:
<div class="highlight"><pre><span class="n">PRIMITIVE_COMPARE</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span> <span class="c1">// Expands to 1</span>
<span class="n">PRIMITIVE_COMPARE</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">foo</span><span class="p">)</span> <span class="c1">// Expands to 0</span>
</pre></div>
So this almost works, but only for tokens that have a corresponding <code>COMPARE_</code> macro defined:
<div class="highlight"><pre><span class="n">PRIMITIVE_COMPARE</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">unfoo</span><span class="p">)</span> <span class="c1">// Should expand to 1, but it expands to 0</span>
</pre></div>
So we add an extra level of detection, to detect whether both of the tokens are comparable, and then calling our <code>PRIMITIVE_COMPARE</code> macro:
<div class="highlight"><pre><span class="cp">#define IS_COMPARABLE(x) IS_PAREN( CAT(COMPARE_, x) (()) )</span>

<span class="cp">#define NOT_EQUAL(x, y) \</span>
<span class="cp">IIF(BITAND(IS_COMPARABLE(x))(IS_COMPARABLE(y)) ) \</span>
<span class="cp">( \</span>
<span class="cp">   PRIMITIVE_COMPARE, \</span>
<span class="cp">   1 EAT \</span>
<span class="cp">))(x, y)</span>
</pre></div>
And now we can create a corresponding <code>EQUAL</code> macro by using our previous <code>COMPL</code> macro:
<div class="highlight"><pre><span class="cp">#define EQUAL(x, y) COMPL(NOT_EQUAL(x, y))</span>
</pre></div>
    </div>
  </div>
  </div>

</div>
<div id="gollum-footer">
  <p id="last-edit">
    Last edited by pfultz2, <time class="js-relative-date" datetime="2013-11-29T15:02:56-08:00" title="2013-11-29 15:02:56">a month ago</time>
  </p>
</div>
</div>


        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><div original-title="" style="position: absolute; left: -9999px; top: -9999px; width: 15px; height: 15px; z-index: 9999;" data-clipboard-ready="true" class="global-zeroclipboard-container" id="global-zeroclipboard-html-bridge">      <object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" id="global-zeroclipboard-flash-bridge" width="100%" height="100%">         <param name="movie" value="https://github.global.ssl.fastly.net/flash/ZeroClipboard.v1.2.1.swf?nocache=1388544680242">         <param name="allowScriptAccess" value="always">         <param name="scale" value="exactfit">         <param name="loop" value="false">         <param name="menu" value="false">         <param name="quality" value="best">         <param name="bgcolor" value="#ffffff">         <param name="wmode" value="transparent">         <param name="flashvars" value="trustedOrigins=github.com">         <embed src="C%20Preprocessor%20tricks,%20tips,%20and%20idioms%20%C2%B7%20pfultz2_Cloak%20Wiki_files/ZeroClipboard.swf" loop="false" menu="false" quality="best" bgcolor="#ffffff" name="global-zeroclipboard-flash-bridge" allowscriptaccess="always" allowfullscreen="false" type="application/x-shockwave-flash" wmode="transparent" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="trustedOrigins=github.com" scale="exactfit" width="100%" height="100%">                </object></div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com/">API</a></li>
      <li><a href="http://training.github.com/">Training</a></li>
      <li><a href="http://shop.github.com/">Shop</a></li>
      <li><a href="https://github.com/blog">Blog</a></li>
      <li><a href="https://github.com/about">About</a></li>

    </ul>

    <a href="https://github.com/">
      <span class="mega-octicon octicon-mark-github"></span>
    </a>

    <ul class="site-footer-links">
      <li>© 2013 <span title="0.06056s from github-fe136-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="https://github.com/site/terms">Terms</a></li>
        <li><a href="https://github.com/site/privacy">Privacy</a></li>
        <li><a href="https://github.com/security">Security</a></li>
        <li><a href="https://github.com/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-fullscreen-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="js-fullscreen-contents" placeholder="" data-suggester="fullscreen_suggester"></textarea>
          <div class="suggester-container">
              <div class="suggester fullscreen-suggester js-navigation-container" id="fullscreen_suggester" data-url="/pfultz2/Cloak/suggestions/commit">
              </div>
          </div>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a original-title="Exit Zen Mode" href="#" class="exit-fullscreen js-exit-fullscreen tooltipped leftwards">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a original-title="Switch themes" href="#" class="theme-switcher js-theme-switcher tooltipped leftwards">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-remove-close close ajax-error-dismiss"></a>
      Something went wrong with that request. Please try again.
    </div>

  


</body></html>